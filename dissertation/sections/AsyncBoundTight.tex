\section{Proof that the asynchronous rumour spreading time bound is almost tight}
\label{section:AsyncLowerBound}

In this section, we prove that the upper bound derived in Section \ref{AsyncUpperBoundSection} is tight, by constructing an example where the spread time is close to the bound with high probability.

\begin{definition}\label{def:HkAB}
 	Graph $H_k(A,B)$

	Let $V$ be a set of $n$ vertices, with $A \subset V$ an arbitrary subset satisfying $\frac{n}{4} \leq |A| \leq \frac{3n}{4}$. Let B denote $V \setminus A$. Let $k = \mathcal{O}\left(\frac{\log n}{\log \log n}\right)$ and $\Delta = \mathcal{O}(\sqrt{n})$ be arbitrary positive integers. We construct the graph $H_k(A,B)$ on the vertex set $V$ using the following steps

	% TODO: Can we adjust k and delta slightly to work for k-regualr ends? 

	\textit{Step 1.} Let $\{S_i, 0 \leq i \leq k\}$ denote an arbitrary set of disjoint subsets of nodes in $V$ such that $|S_i| = \Delta$ for all $i$, $S_0 \subseteq A$ and $S_i \subseteq B$ for $1 \leq i \leq k$. We connect each node of $S_i$ to all nodes in $S_{i+1}$ for $0 \leq i \leq k - 1$. This generates a string of $k$ complete bipartite graphs, as seen in Figure \ref{fig:HkAB_1}.

	%TODO: Graph after step 1 

    \begin{figure}[h]
        \centering
        \input{figures/HkAB_1.tex}
        \caption{Construction of $H_k(A,B)$ after Step 1}
        \label{fig:HkAB_1}
    \end{figure}
    
	\textit{Step 2.} Let $G_A$ be an arbitrary m-regular %TODO: Fill in once decided on ending graphs
	graph on $A \setminus S_0$ such that $\Phi(G_A) = \Theta(1)$. %TODO: remove this??

	% TODO: m-regular graph 
	% https://sites.math.rutgers.edu/~sk1233/courses/topics-S13/lec8.pdf
	% Margulis–Gabber–Galil convert to simple graph?

	We now connect each node of $S_0$ to $\Delta$ distinct nodes of $G_A$. First, we arbitrarily enumerate the nodes in $S_0$ and $G_A$ as $v_1, v_2, \dots, v_\Delta$ and $u_1, u_2, \dots, u_{|G_A|}$ respectively. Connect $v_1$ to the first $\Delta$ nodes in the $G_A$, starting with $u_1$. Connect $v_2$ to the next $\Delta$ nodes in $G_A$, starting with $u_{\Delta + 1}$.
	Repeat this process for each $v_i$, as in Figure \ref{fig:HkAB_2}.
	If there are more new connections than nodes in $G_A$, reuse nodes in $G_A$ starting again from $u_1$ and forming new connections in the enumerated order, i.e the $i^\text{th}$ new connection should be made with node $u_m$ where $m = i\mod |G_A|$.

    \begin{figure}[h]
        \centering
        \input{figures/HkAB_2.tex}
        \caption{Illustration of the enumeration technique used in Step 2}
        \label{fig:HkAB_2}
    \end{figure}


	\textit{Step 3.} Let $G_B$ be an arbitrary m-regular graph on $B \setminus \bigcup_{i=1}^k S_i$ such that $\Phi(G_B) = \Theta(1)$. 
	We generate $G_B$ using the same construction as in Step 2. We then connect each node of $S_k$ to $\Delta$ distinct nodes of $G_B$ using the same enumeration method as in Step 2. This yields the graph $H_k(A,B)$ illustrated in Figure \ref{fig:HkAB_3}.

    \begin{figure}[h]
        \centering
        \input{figures/HkAB_3.tex}
        \caption{Construction of $H_k(A,B)$ after Step 3}
        \label{fig:HkAB_3}
    \end{figure}

	%TODO: explain how Winding around the ring increases the degree by at most an additive constant O(sqrt(n))^2 extra edges O(n) nodes in A \ S_0 so by O notation at most addivie constant difference

\end{definition}

We note that Definition \ref{def:HkAB} technically specifies a family of graphs, since the construction relies on choosing arbitrary permutations of vertices, each of which yields a distinct graph. However, for the purposes of this analysis we think of $H_k(A,B)$ as a single graph as all graphs in the family are isomorphic, and thus have the same structural properties needed for the proof. % TODO: Remove this paragraph? premature?

\begin{definition}
	$\rho$-diligent Dynamic Network
	
	First we define the sequences of node subsets $(A_t)_{t\geq 0}$ and $(B_t)_{t\geq0}$ with $A_t, B_t \subseteq V$ for all $t$. For each $t$, we construct $A_t$ and $B_t$ such that they partition $V$ into two subsets, as follows:

	Let $A_0$ be an arbitrary subset of $V$ of size $\ceil{\frac{n}{4}}$ containing the first node to be aware of the rumour. % TODO: Any problem with ceiling function?
	Set $B_0 = V \setminus A_0$. Let $B_{t+1} = B_t \setminus I_{t+1}$, i.e. the set of nodes in $B_t$ that were still not informed of the rumour by round $t+1$. Let $A_{t+1} = V \setminus A_t$, i.e. the set of nodes that were either in $A_0$ or informed of the rumour by round $t+1$.

	Now we can define the dynamic network $\rho$-diligent Dynamic Network $\mathcal{G}(n, \rho) = (G_t)_{t\geq 0}$ itself. 
	% TODO: Check sequnce notation consistent, 0 not in N
	% TODO: Does \Delta satisfy conditions required for H_\Delta(A,B)
	% TODO: Standardise notation for H_K(A,B)

	Let $\Delta = \ceil{\frac{1}{\rho}}$, and $k = \mathcal{O}(\log n / \log \log n)$.
	Let $G_t = H_{k, \Delta}(A_t, B_t)$ while $|B_t| \geq \frac{n}{4}$. Note that since $\Delta = \mathcal{O}(\sqrt{n})$ by the definition of $H_{k, \Delta}(A,B)$, we must have that $\rho = \Omega\left(\frac{1}{\sqrt{n}}\right)$.
	Note also that $|B_t|$ is decreasing in $t$ since $B_t$ is a subset of the uniformed nodes at time $t$, so at some time step $l$ we have that $|B_l| < \frac{n}{4}$. For all time steps $t \geq l$, let $G_{t+1} = G_t$, since we cannot construct $H_\Delta(A,B)$ if $|B| < \frac{n}{4}$ as this would imply $|A| = |\comp{B}| > \frac{3n}{4}$. % TODO: Reword ending$
\end{definition}

First we use Theorem \ref{theorem:AsyncUpperBound} to bound the rumour spreading time of Algorithm \ref{NodeCentricAsyncAlgorithm} on a $\rho$-diligent dynamic network.

\begin{theorem}
	With high probability, the rumour spreading time of Algorithm \ref{NodeCentricAsyncAlgorithm} on a $\rho$-diligent dynamic network with $n$ vertices, where $\rho = \Omega(\frac{1}{\sqrt{n}})$, is at most 
	$$
		\mathcal{O}\left(\left(\rho n + \frac{k}{\rho}\right)\log n\right)
	$$
\end{theorem}

\begin{proof}
	To determine a concrete bound using Theorem \ref{theorem:AsyncUpperBound}, we need to calculate $\Phi(G_t)$ and $\rho(G_t)$. Since $G_t = H_{k, \Delta}(A, B)$ for some $A$ and $B$ at each time step, it suffices to calculate the conductance and diligence for a general $H_{k, \Delta}(A, B)$.

	\textbf{Claim 1.} $\Phi(H_{k, \Delta}(A, B)) = \Theta\left(\frac{\Delta^2}{k\Delta^2 +n }\right)$

	For $q = 1, \dots, k$, let $A_q = G_A \cup \bigcup_{i=1}^q  S_i$. We want to calculate $\text{vol}(A_q)$. The degree of any arbitrary node in $S_i$ is $2\Delta$, since it is connected to all $\Delta$ nodes in $S_{i-1}$ and all $\Delta$ nodes in $S_{i+1}$, where we set $S_0 = G_A$ and $S_{k+1} = G_B$ for brevity. Since there are $\Delta$ nodes in each $S_i$, $\text{vol}(S_i) = 2\Delta^2$. By taking the disjoint union of $q$ $S_i$ subsets, we obtain that $\text{vol}(\bigcup_{i=1}^q) = 2q\Delta^2$. Now we consider $\text{vol}(G_A)$. Since $|A| = \Theta(n)$ and $|S_i| = \Delta = \mathcal{O}(\sqrt{n})$, 
	$$
		|G_A| = |A \setminus S_0| = |A| - |S_0| = \Theta(n) - \mathcal{O}(\sqrt{n}) = \Theta(n)
	$$
	By construction each node in $G_A$ is connected to exactly $m$ % TODO: Replace with actual number
	other nodes in $G_A$, so internal edges contribute $\Theta(n)$ degree to $\text{vol}(G_A)$. The only other edges which terminate in $G_A$ are the $\Delta^2$ edges between $G_A$ and $S_0$, thus $\text{vol}(G_A) = \Delta^2 + \Theta(n)$. By taking the disjoint union of $G_A$ and $\bigcup_{i=1}^q S_i$ we obtain $\text{vol}(A_q) = (2q + 1)\Delta^2 + \Theta(n)$. % TODO: Check as doesn't match paper.
	
	Note that for any $q$, $|E(A_q,\comp{A_q})| = \Delta^2$ since the only edges connecting $A_q$ and $\comp{A_q}$ are the edges passing between $S_q$ and $S_{q+1}$. This is most easily seen by inspecting Figure \ref{fig:HkAB_3}, and noting that $A_q$ corresponds to the first $q + 1$ sets of nodes in the string, while $\comp{A_q}$ corresponds to the remaining $k - q + 1$ sets of noes at the end of the string. By construction, each of these cuts consist of exactly $\Delta^2$ edges, thus $|E(A_q,\comp{A_q})| = \Delta^2$ as claimed.
	Hence, we can derive an upper bound on the conductance of $H_{k, \Delta}(A, B)$ by evaluating the conductance expression for the set $A_q$ instead of the set which achieves the minimum. 
	$$
		\Phi(H_{k, \Delta}(A, B)) \leq \frac{|E(A_q, \comp{A_q})|}{\min \left\{ \text{vol}(A_q), \text{vol}(\comp{A_q}) \right\} } % TODO: THIS INEQUALITY DOESN'T WORK
		\leq \frac{|E(A_q, \comp{A_q})|}{\text{vol}(A_q)} = \frac{\Delta^2}{(2q + 1)\Delta^2 + \Theta(n)}
	$$	
	% TODO: Prove that A_k is the minimal set

	% TODO: Finish this

	\textbf{Claim 2.} $\rho(H_{k, \Delta}(A,B)) = \Theta\left(\frac{1}{\Delta}\right)$

	First we consider the set of vertices $A = G_A \cup S_0$ for which the minimal diligence is achieved. % TODO: Check this works with A instead of A_1 (used in paper)
	We have that $\text{vol}(A) = 2\Delta^2 + \Theta(n)$ since $S_0$ contributes $2\Delta^2$ degree and $G_A$ contributes $\Theta(n)$ degree as shown in claim 1. Since $\Delta = \mathcal{O}(\sqrt{n})$, we obtain that 
	$$
		\text{vol}(A) = 2 \mathcal{O}(\sqrt{n})^2 + \Theta(n) = \mathcal{O}(n) + \Theta(n) = \Theta(n)
	$$ % TODO: Check adding theta and O gives theta
	Since $|A| = \Theta(n)$ by construction we have that the average degree of $A$ $\bar{d}(A) = \frac{\text{vol}(A)}{|A|} = \frac{\Theta(n)}{\Theta(n)} = \Theta(1)$. To compute the diligence of $A$, we now consider the cut set $E(A, \comp{A})$. Since every endpoint of the cut set has degree $2\Delta$, we get that 
	$$
		\min_{\{u, v\} \in E(A, \comp{A})} \max \left\{ \frac{1}{d_u}, \frac{1}{d_v} \right\} = \frac{1}{2\Delta}
	$$
	Hence, the diligence of $A$ is 
	$$
		\rho(A) = \frac{\bar{d}(A)}{2\Delta} = \Theta\left(\frac{1}{\Delta}\right)
	$$ 
	% TODO: Prove no set with lower diligence exists


	We can now apply the bound from Theorem \ref{theorem:AsyncUpperBound}, to yield an upper bound on the spreading time of a $\rho$-diligent dynamic network $\mathcal{G}(n, \rho) = (G_t)_{t\geq 0}$. 
	
	From Theorem \ref{theorem:AsyncUpperBound}, we have that the first $T$ for which $\sum_t^T \Phi(G_t)\rho(G_t)$ exceeds $C \log n = \mathcal{O}(\log n)$ is an upper bound on the spreading time with high probability.  Note that 
	$$
		\sum_t^T \Phi(G_t)\rho(G_t)
		= 
		T \Theta\left(\frac{\Delta^2}{k\Delta^2 +n }\right) \Theta\left(\frac{1}{\Delta}\right)
		= 
		T \Theta\left(\frac{\Delta}{k\Delta^2 +n }\right)
		= 
		T \Theta\left(\frac{1}{n \rho + \frac{k}{\rho}}\right)
	$$
	since $G_t = H_{k, \Delta}(A_t,B_t)$ for all $t$, where $\Delta = \floor{\frac{1}{\rho}} = \Theta\left(\frac{1}{\rho}\right)$ by the definition of the dynamic network. Hence 
	$$
		\min \left\{T : \sum_t^T \Phi(G_t)\rho(G_t) \geq C \log n \right\}
		=
		\frac{\mathcal{O}(\log n)}{\Theta\left(\frac{1}{n \rho + \frac{k}{\rho}}\right)}
		= 
		\mathcal{O}\left(\log n \left(n \rho + \frac{k}{\rho}\right)\right)
	$$
	% TODO: Resolve k -> 0 log n -> +inf -> (check multaplicitve difference between log n from upper bound and 1/k for lower bound)
	% 		- why choice of log n / log log n for k?
\end{proof}

Now we verify that the upper bound is tight by computing a lower bound on the spreading time for a $\rho$-diligent dynamic network that holds with high probability.

% TODO: Talk about restrictions on rho and k later?
\begin{theorem}
	With high probability, the rumour spreading time of Algorithm \ref{NodeCentricAsyncAlgorithm} on a $\rho$-diligent dynamic network with $n$ vertices, where $\rho = \Omega(\frac{1}{\sqrt{n}})$, is at least 
	$$
		\Omega\left(\frac{n \rho}{k}\right)
	$$
\end{theorem}

\begin{proof}
	
\end{proof}